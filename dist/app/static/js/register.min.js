"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

//  解决get请求的缓存问题
function sendAjax(url, obj) {
  var xhr = new XMLHttpRequest();
  var _default = {
    method: 'GET',
    data: null
  };

  if (obj) {
    if (_typeof(obj) == "object") {
      for (var key in _default) {
        if (key in obj) {
          _default[key] = obj[key];
        }
      }
    }
  }

  _default.method = _default.method.toUpperCase();

  if (_default.method == 'GET') {
    var flag = url.indexOf('?') == -1 ? "?" : "&";
    url += flag;

    for (var i in _default.data) {
      var keyValue = "".concat(i, "=").concat(_default.data[i]);
      url += keyValue + '&';
    } // 添加一个时间戳, 解决get请求的缓存问题


    url += "_=".concat(Date.now());
    _default.data = null;
  } else if (_default.method == 'POST') {
    _default.data = JSON.stringify(_default.data);
  } else {
    console.log('告辞!');
    return;
  }

  xhr.open(_default.method, url, true);
  xhr.send(_default.data);
  return new Promise(function (resolve, reject) {
    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
        if (xhr.status == 200 && xhr.responseText != "false") {
          resolve();
        } else {
          reject();
        }
      }
    };
  });
}

<<<<<<< HEAD
=======
'use strict';

>>>>>>> aa5c2c1d00a067c900c8d4ef1bf5a20178bca7d8
var CheckForm =
/*#__PURE__*/
function () {
  function CheckForm() {
    _classCallCheck(this, CheckForm);
  }

  _createClass(CheckForm, [{
    key: "username",
    value: function username(name) {
      if (/\w{6,10}/.test(name)) {
        return true;
      }

      return false;
    }
  }, {
    key: "password",
    value: function password(ps) {
      if (/^.{6,16}$/.test(ps)) {
        if (/[A-z][0-9]|[0-9][A-z]/.test(ps)) {
          return true;
        }
      }

      return false;
    }
  }, {
    key: "telphone",
    value: function telphone(tel) {
      if (/^1[35789]\d{9}$/.test(tel)) {
        return true;
      }

      return false;
    }
  }, {
    key: "repassword",
    value: function repassword(ps) {
      if (ps === '') {
        return false;
      }

      var ps = document.getElementById('password').value;
      var rps = document.getElementById('password').value;

      if (ps === rps) {
        return true;
      }

      return false;
    }
  }]);

  return CheckForm;
}();

var checkInfor = function () {
  var $form = document.querySelector('.registerForm');
  var $inps = $form.querySelectorAll('input'); //获取到“获取验证码”按钮

  var $get_yanzhengma = document.querySelector('.phone_yanzhengma_button');
  var yzm = null;
  var resetTime = 60; //获取到“同意阅读协议”按钮

  var $agree = document.querySelector('.agreement input'); //获取到提交按钮

  var $sub = document.querySelector('.sub input');
  return {
    init: function init() {
      this.event();
    },
    event: function event() {
      var self = this;

      var _loop = function _loop(i) {
        $inps[i].onblur = function (e) {
          e = e || window.event;
          var checkForm = new CheckForm();

          if ($inps[i].name === "telphone") {
            var $div = $inps[i].parentNode.querySelector("span");

            if (checkForm[$inps[i].name]($inps[i].value)) {
              if ($inps[i].name === 'telphone') {
<<<<<<< HEAD
                sendAjax("../server/php/check.php", {
=======
                sendAjax("http://localhost:1234/php/my-nubia/server/php/login.php", {
>>>>>>> aa5c2c1d00a067c900c8d4ef1bf5a20178bca7d8
                  data: {
                    "telphone": $inps[i].value
                  }
                }).then(function (res) {
                  $div.innerHTML = "";
                  self.success($inps[i]);
                }).catch(function (res) {
                  $div.innerHTML = "手机号已被注册";
                });
              }
            } else if ($inps[i].value == "") {
              $div.innerHTML = "请输入手机号";
            } else {
              $div.innerHTML = "手机号格式输入错误";
            }
          } else if ($inps[i].name === "password") {
            var $div1 = $inps[i].parentNode.querySelector("span");

            if (checkForm[$inps[i].name]($inps[i].value)) {
              $div1.innerHTML = "";
              self.success($inps[i]);
            } else if ($inps[i].value == "") {
              $div1.innerHTML = "请输入密码";
            } else {
              $div1.innerHTML = "密码格式输入错误";
            }
          } else if ($inps[i].name === "yanzhengma") {
            var $div2 = $inps[i].parentNode.querySelector("span");

            if ($inps[i].value == "") {
              $div2.innerHTML = "请输入验证码";
            } else {
              $div2.innerHTML = "";
              self.success($inps[i]);
            }
          }
        };
      };

      for (var i = 0; i < 3; i++) {
        _loop(i);
      }

      ;

      $get_yanzhengma.onclick = function (e) {
        e = e || window.event;
        $get_yanzhengma.disabled = "disabled";
        clearInterval(yzm);
        $get_yanzhengma.value = "\u91CD\u65B0\u53D1\u9001(".concat(resetTime, ")");
        yzm = setInterval(function () {
          resetTime--;
          $get_yanzhengma.value = "\u91CD\u65B0\u53D1\u9001(".concat(resetTime, ")");

          if (resetTime == 0) {
            clearInterval(yzm);
            $get_yanzhengma.value = "\u83B7\u53D6\u9A8C\u8BC1\u7801";
            resetTime = 60;
            $get_yanzhengma.disabled = "";
          }
        }, 1000);
      };

      $sub.onclick = function (e) {
        e = e || window.event;

<<<<<<< HEAD
        for (var i = 0; i < 3; i++) {
          if ($inps[i].className.indexOf("has-success") === -1) {
            $inps[i].focus();
=======
        for (var j = 0; j < 3; j++) {
          if ($inps[j].className.indexOf("has-success") === -1) {
            $inps[j].focus();
>>>>>>> aa5c2c1d00a067c900c8d4ef1bf5a20178bca7d8
            return false;
          }
        }
      };
    },
    success: function success($div) {
      $div.className = $div.className.replace(/(\s?has-error|\s?has-success)/g, '');
      $div.className += 'has-success';
    }
  };
}();